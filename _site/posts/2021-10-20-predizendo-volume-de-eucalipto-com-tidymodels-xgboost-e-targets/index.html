<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>Theilon Macedo: Predizendo volume de eucalipto com tidymodels, XGBoost e targets</title>

<meta property="description" itemprop="description" content="&quot;Como montar um ambiente reprodutível para o ajuste de modelos de predição do volume de eucalipto.&quot;"/>


<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-10-20"/>
<meta property="article:created" itemprop="dateCreated" content="2021-10-20"/>
<meta name="article:author" content="Theilon Macedo"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Theilon Macedo: Predizendo volume de eucalipto com tidymodels, XGBoost e targets"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="&quot;Como montar um ambiente reprodutível para o ajuste de modelos de predição do volume de eucalipto.&quot;"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Theilon Macedo"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Theilon Macedo: Predizendo volume de eucalipto com tidymodels, XGBoost e targets"/>
<meta property="twitter:description" content="&quot;Como montar um ambiente reprodutível para o ajuste de modelos de predição do volume de eucalipto.&quot;"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","preview","output"]}},"value":[{"type":"character","attributes":{},"value":["Predizendo volume de eucalipto com tidymodels, XGBoost e targets"]},{"type":"character","attributes":{},"value":["\"Como montar um ambiente reprodutível para o ajuste de modelos de predição do volume de eucalipto.\""]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Theilon Macedo"]}]}]},{"type":"character","attributes":{},"value":["2021-10-20"]},{"type":"character","attributes":{},"value":["featured.jpg"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["featured.jpg","normalized decision tree.png","normalized_xgb.png","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/anchor-4.2.2/anchor.min.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/bowser-1.9.3/bowser.min.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/distill-2.2.21/template.v2.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/header-attrs-2.11/header-attrs.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/jquery-3.6.0/jquery-3.6.0.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/jquery-3.6.0/jquery-3.6.0.min.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/jquery-3.6.0/jquery-3.6.0.min.map","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/popper-2.6.0/popper.min.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/tippy-6.2.7/tippy-bundle.umd.min.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/tippy-6.2.7/tippy-light-border.css","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/tippy-6.2.7/tippy.css","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/tippy-6.2.7/tippy.umd.min.js","predizendo-volume-de-eucalipto-com-tidymodels-xgboost-e-targets_files/webcomponents-2.0.0/webcomponents.js","rsq.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.11/header-attrs.js"></script>
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Predizendo volume de eucalipto com tidymodels, XGBoost e targets","description":"\"Como montar um ambiente reprodutível para o ajuste de modelos de predição do volume de eucalipto.\"","authors":[{"author":"Theilon Macedo","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-10-20T00:00:00.000-03:00","citationText":"Macedo, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="../../index.html" class="title">Theilon Macedo</a>
</div>
<div class="nav-right">
<a href="../../index.html">Home</a>
<a href="../../about.html">About</a>
<a href="../../blog.html">Posts</a>
<a href="https://github.com/TheilonMacedo">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/TheilonMacedo">
<i class="fa fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://www.linkedin.com/in/theilonmacedo/">
<i class="fa fa-linkedin" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Predizendo volume de eucalipto com tidymodels, XGBoost e targets</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>“Como montar um ambiente reprodutível para o ajuste de modelos de predição do volume de eucalipto.”</p></p>
</div>

<div class="d-byline">
  Theilon Macedo  
  
<br/>2021-10-20
</div>

<div class="d-article">
<div class="layout-chunk" data-layout="l-body">
<div class="figure"><span id="fig:unnamed-chunk-1"></span>
<img src="featured.jpg" alt="Workflow do trabalho."  />
<p class="caption">
Figure 1: Workflow do trabalho.
</p>
</div>
</div>
<p>Umas das dificuldades encontradas na academia é a reprodutibilidade de trabalhos. Essa é uma situação que, infelizmente, é corriqueira na área florestal. Neste texto, apresento algumas ferramentas que buscam melhorar a forma que trabalhos podem ser replicados, como a utilização dos pacotes here e renv.<br />
Aproveitando o embalo, também mostro como usar o pacote tidymodels para a predição do volume de eucalipto. O dataset utilizado neste projeto é oriundo do excelente <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0238703">trabalho</a> publicado no ano de 2020 pelo professor Gileno Azevedo juntamente com outros pesquisadores. O dataset pode ser encontrado na página do artigo. Vamos lá!</p>
<h2 id="ª-etapa---iniciando-o-projeto">1ª etapa - Iniciando o projeto</h2>
<p>Antes de qualquer coisa, preciso falar de 3 ferramentas básicas quando se busca reprodutibilidade em trabalhos no R:</p>
<ul>
<li>renv<br />
Este pacote é um gerenciador de dependências: ele organiza e “memoriza” as dependências (como pacotes) que o seu projeto está usando de modo que, caso alguém refaça suas análises, não ocorra problemas como o uso de pacotes de versões distintas, além de tornar seu ambiente de trabalho isolado. Mais à frente explicarei outra importante vantagem. Caso queira saber mais sobre o renv, esse tutorial do <a href="https://6chaoran.wordpress.com/2020/07/20/introduction-of-renv-package/">Chaoran</a> é show.</li>
<li>R Projects<br />
É o mais simples dessa lista. Basicamente toda vez que você for criar um projeto, o ideal é que seja criada uma pasta principal e dentro dela serão criadas as demais pastas (data, R, etc.). Em seguida, abra o RStudio e crie um Project dentro desta pasta principal. A organização destas pastas terá a seguinte estrutura (a mesma utilizada neste trabalho):</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Eucalipto_Volume (pasta principal)  </span>
<span class='co'>#      |--Eucalipto_Volume.Rproj</span>
<span class='co'>#      |--R  </span>
<span class='co'>#      |--plots</span>
<span class='co'>#      |--report</span>
</code></pre>
</div>
</div>
<ul>
<li>here<br />
Esse aqui é o mais legal: basicamente ele te permite criar caminhos relativos. Por ex.: ao invés de se referir a um arquivo como <code>dados &lt;- C:user/zezin/uma/duas/dados/meus_dados.csv</code>, ou usar <code>setwd("C:user/zezin/uma/duas/dados")</code>, prefira salvar seu Project em uma pasta principal e se referir a ele como <code>here::here("dados", "meus_dados.csv")</code>. Isso facilita que outras pessoas reproduza suas análises sem grandes problemas. Tem um pessoal que recomenda <a href="https://twitter.com/jennybryan/status/940436177219338240">fortemente</a> usar o pacote here. Basicamente ele define o caminho de acesso aos arquivos a partir da última pasta do caminho (top-level folder), que no nosso exemplo hipotético é a pasta “dados”.</li>
</ul>
<h3 id="mão-na-massa">Mão na massa</h3>
<p>A primeira coisa que fiz foi criar uma pasta principal. Em seguida, criei dentro dela um R Project com o nome do meu projeto (Eucalipto_Volume). Então instalei o renv e executei o comando <code>renv::init()</code> para criar um ambiente local do projeto. A partir daí, iniciei as análises e instalei os pacotes básicos iniciais necessários (incluindo o here). Sempre que instalava um novo pacote, chamava <code>renv::snapshot()</code> para atualizar os estado do projeto e as dependências. Caso fosse necessário reverter alguma alteração de dependência no projeto após chamar <code>renv::snapshot()</code>, era acionado o comando <code>renv::restore(</code>). Pronto! Meu ambiente local do projeto está montado e isolado. Bacana, né?</p>
<h2 id="ª-etapa---modelagem">2ª etapa - Modelagem</h2>
<p>Agora a parte legal: a modelagem dos dados! Recentemente tem ganhado bastante tração um pacote de modelagem do R baseado na filosofia do tidyverse: o <a href="https://www.tidymodels.org/">tidymodels</a>. Esse pacote é incrível, permitindo usar diversos modelos de machine learning de forma extremamente intuitiva e bem elegante. A seguir vou mostrar o passo a passo necessário para ajustar e testar diversos modelos visando a predição do volume de eucalipto.</p>
<p>Carregando os pacotes necessários:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://here.r-lib.org/'>here</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sfirke/janitor'>janitor</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/alexkowa/EnvStats'>EnvStats</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://petersonr.github.io/bestNormalize/'>bestNormalize</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/finetune'>finetune</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>doParallel</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/wch/extrafont'>extrafont</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="aquisição-dos-dados">Aquisição dos dados</h3>
<p>Primeiramente serão adquiridas as bases de dados (treino e teste) a serem utilizadas no projeto a partir do site que disponibiliza o artigo e os dados. Aqui será criada uma pasta “data” onde os arquivos da base de dados serão baixados.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Criando o diretório onde a base será alocada</span>
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='st'>"data"</span><span class='op'>)</span>

<span class='co'># Acesso ao material</span>
<span class='va'>link_train</span> <span class='op'>&lt;-</span> <span class='st'>"https://doi.org/10.1371/journal.pone.0238703.s007"</span>
<span class='va'>link_test</span> <span class='op'>&lt;-</span> <span class='st'>"https://doi.org/10.1371/journal.pone.0238703.s008"</span>

<span class='co'># Aqui é criado o caminho de acesso às bases de dados</span>
<span class='va'>dest_folder_train</span> <span class='op'>&lt;-</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"train.xlsx"</span><span class='op'>)</span>
<span class='va'>dest_folder_test</span> <span class='op'>&lt;-</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"test.xlsx"</span><span class='op'>)</span>

<span class='co'># Aquisição da base de teste e treino usadas pelos autores do trabalho</span>
<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>link_train</span>, 
                     destfile <span class='op'>=</span> <span class='va'>dest_folder_train</span>, 
                     mode <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>

<span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>link_test</span>, 
                     destfile <span class='op'>=</span> <span class='va'>dest_folder_test</span>, 
                     mode <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Perceba que aqui é usado o pacote here para a criação de um caminho relativo até a pasta de destino, em que o caminho até a pasta objetivo (neste caso, a pasta “data”) se inicia a partir da pasta principal criada para o projeto (Eucalipto_Volume), e não do seu diretório base. Caso a pasta principal do projeto seja alterada para outra partição, não será necessário chamar <code>setwd()</code> com um novo caminho.<br />
E qual a vantagem disso? Isso permite que você ou qualquer outra pessoa não precise alterar o caminho caso queira carregar/salvar as informações obtidas das mesmas análises aqui apresentadas. A utilização desse pacote é uma boa prática quando falamos de project-oriented workflows (workflow montado tendo como base projects).</p>
<h3 id="preparando-os-dados">Preparando os dados</h3>
<p>As bases de dados foram separadas originalmente pelos autores em dois arquivos. Essa é uma boa prática para criação de modelos e sua subsequente avaliação. Dividir os sets dessa forma permite que não ocorra data leakage (quando seu modelo, na fase de treino, “entra em contato” com os dados de teste, causando overfitting). Entretanto, uma vantagem do tidymodels é que ele permite o split entre set de treino e set de teste de forma unificada, sendo geradas partições de um mesmo arquivo sem a ocorrência de data leakage. Para ilustrar essa capacidade, os datasets serão unidos e então será mostrado como realizar a sua separação em treino e teste com o tidymodels:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Carregando a base de daoos separada</span>
<span class='va'>sheet_train</span> <span class='op'>&lt;-</span> <span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"train.xlsx"</span><span class='op'>)</span>, 
                                  skip <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>sheet_test</span> <span class='op'>&lt;-</span> <span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"test.xlsx"</span><span class='op'>)</span>, 
                                 skip <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='co'># Unificando a base e "limpando os nomes" das colunas</span>
<span class='va'>dataset</span> <span class='op'>&lt;-</span> 
    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>sheet_train</span>, <span class='va'>sheet_test</span><span class='op'>)</span> |&gt;
    <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> |&gt; 
    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>stem</span><span class='op'>:</span><span class='va'>rotation</span><span class='op'>)</span>, 
                         <span class='fu'>forcats</span><span class='fu'>::</span><span class='va'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>)</span>,
                  <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>tx</span>, <span class='va'>d</span><span class='op'>)</span>, <span class='va'>as.integer</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="iniciando-o-processo-de-modelagem">Iniciando o processo de modelagem</h3>
<p>Após unificar os dados, vamos colocar a mão na massa! A primeira coisa a ser feita é dividir os dados em treino e teste e então realizar a reamostragem repetida do set de treino para validação dos modelos. O tidymodels faz isso de forma prática:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1504</span><span class='op'>)</span>

<span class='va'>vol_split</span> <span class='op'>&lt;-</span> <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>initial_split</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>dataset</span>, 
                                    prop <span class='op'>=</span> <span class='fl'>0.75</span>, 
                                    strata <span class='op'>=</span> <span class='va'>cod_volume</span><span class='op'>)</span>
<span class='va'>train_split</span> <span class='op'>&lt;-</span> <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>training</a></span><span class='op'>(</span><span class='va'>vol_split</span><span class='op'>)</span>
<span class='va'>test_split</span> <span class='op'>&lt;-</span> <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>testing</a></span><span class='op'>(</span><span class='va'>vol_split</span><span class='op'>)</span>

<span class='co'># Realizando validação cruzada repetida para avaliação dos modelos</span>
<span class='va'>vol_folds</span> <span class='op'>&lt;-</span> <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/vfold_cv.html'>vfold_cv</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span>, 
                               strata <span class='op'>=</span> <span class='va'>cod_volume</span>, 
                               repeats <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Algumas considerações nessa etapa:</p>
<ul>
<li>O split inicial foi realizado usando uma proporção de 3/4.<br />
</li>
<li>A divisão foi estratificada de acordo com as classes de volume comercial.<br />
</li>
<li>O tidymodels permite a divisão do dataset de forma simples e que não ocorra data leakage, dispensando a necessidade de separar os dados manualmente.</li>
</ul>
<h3 id="explorando-os-dados">Explorando os dados</h3>
<p>Neste caso, temos um set de dados com poucos preditores: dbh (DAP) e h (Altura). Neste dataset também constam as variáveis tx e d que dizem respeito a se o volume de madeira predito é com casca ou sem casca (0 ou 1) e o diâmetro comercial, respectivamente. De modo a observar os padrões dos dados, vamos fazer uma análise exploratória básica das variáveis:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_density</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>dbh</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"DAP"</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_density</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>h</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>labs</span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Altura"</span><span class='op'>)</span>

<span class='co'># Explorando as relações entre as variáveis principais</span>
<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>stat_count</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>cod_volume</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>dbh</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>dbh</span><span class='op'>^</span><span class='fl'>2</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>h</span><span class='op'>^</span><span class='fl'>2</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>h</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>dbh</span><span class='op'>*</span><span class='va'>h</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='op'>(</span><span class='va'>dbh</span><span class='op'>*</span><span class='va'>h</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'>ggplot</span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>geom_point</span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>dbh</span>, y <span class='op'>=</span> <span class='va'>h</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Neste caso, é recomendável normalizar os dados antes de seguir com a modelagem. Sem a padronização, uma variável pode ter um maior <a href="https://stats.stackexchange.com/questions/29781/when-conducting-multiple-regression-when-should-you-center-your-predictor-varia">impacto</a> sobre a resposta apenas por conta da sua escala, o que pode ser o caso aqui dadas as próprias unidades (cm e m) dos dados Essa normalização será aplicada mais à frente na modelagem.<br />
Pode-se perceber também que a adição de interações e de termos quadráticos tornam a relação entre os preditores, especificamente dap e h, mais linear.<br />
Também é possível observar que as classes de volume não possuem a mesma quantidade de observações. Neste caso, pode-se seguir com duas estratégias: a primeira seria ajustar um modelo para cada um dos diferentes volumes em separado; a segunda consiste na divisão ponderada (estratificação) no split dos dados (o treino e o teste teriam a mesma proporção de cada classe de volume). Neste trabalho, seguiremos a segunda estratégia.</p>
<h3 id="ajustando-os-modelos">Ajustando os modelos</h3>
<p>Agora vem a parte onde a mágica do tidymodels acontece: Primeiro é definida uma recipe do passo-a-passo que os dados devem ser processados. Em seguida são definidas as especificações modelos a serem utilizados. Serão definidas duas recipes (receitas de passo-a-passo): uma sem pré-processamento e outra pré-processada (com adião de interações, termos quadráticos e normalização):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Definindo os pré-processamentos dos dados</span>
<span class='va'>simple_vol_rec</span> <span class='op'>&lt;-</span> <span class='fu'>recipes</span><span class='fu'>::</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span><span class='va'>v</span> <span class='op'>~</span> <span class='va'>dbh</span> <span class='op'>+</span> <span class='va'>h</span> <span class='op'>+</span> <span class='va'>tx</span> <span class='op'>+</span> <span class='va'>d</span>, data <span class='op'>=</span> <span class='va'>train_split</span><span class='op'>)</span>

<span class='va'>normalized_vol_rec</span> <span class='op'>&lt;-</span> <span class='va'>simple_vol_rec</span> |&gt; 
  <span class='fu'>recipes</span><span class='fu'>::</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/step_interact.html'>step_interact</a></span><span class='op'>(</span>terms <span class='op'>=</span> <span class='op'>~</span> <span class='va'>dbh</span><span class='op'>:</span><span class='va'>h</span><span class='op'>)</span> |&gt;  
  <span class='fu'>recipes</span><span class='fu'>::</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/step_mutate.html'>step_mutate</a></span><span class='op'>(</span>dbh_sqrd <span class='op'>=</span> <span class='va'>dbh</span><span class='op'>^</span><span class='fl'>2</span>, 
                       h_sqrd <span class='op'>=</span> <span class='va'>h</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span> |&gt; 
  <span class='fu'>recipes</span><span class='fu'>::</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/step_normalize.html'>step_normalize</a></span><span class='op'>(</span><span class='fu'>recipes</span><span class='fu'>::</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_predictors</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>-</span><span class='va'>tx</span>, <span class='op'>-</span><span class='va'>d</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Aqui pode-se perceber que a recipe <code>normalized_vol_rec</code> é apenas a recipe <code>simple_vol_rec</code> com mais “passos” adicionados.</p>
<p>Em seguida, são definidos os diversos modelos a serem ajustados e depois testados. Estes modelos terão os hiperparâmetros mais importantes “marcados” para tunagem usando a função tune::tune.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Definindo diversos modelos</span>
<span class='va'>lm_mod</span> <span class='op'>&lt;-</span> 
     <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span><span class='op'>)</span> |&gt; 
     <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"lm"</span><span class='op'>)</span> |&gt; 
     <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>
  
<span class='va'>penalized_lm_mod</span> <span class='op'>&lt;-</span> 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span>penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                      mixture <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"glmnet"</span><span class='op'>)</span> |&gt;
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>bag_mars_mod</span> <span class='op'>&lt;-</span> 
  <span class='fu'>baguette</span><span class='fu'>::</span><span class='fu'><a href='https://baguette.tidymodels.org/reference/bag_mars.html'>bag_mars</a></span><span class='op'>(</span>prod_degree <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, 
                     prune_method <span class='op'>=</span> <span class='st'>"exhaustive"</span>,
                     num_terms <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"earth"</span>, times <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>
  
<span class='va'>dec_tree</span> <span class='op'>&lt;-</span> 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/decision_tree.html'>decision_tree</a></span><span class='op'>(</span>cost_complexity <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                         tree_depth <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                         min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"rpart"</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>bag_cart_mod</span> <span class='op'>&lt;-</span> 
  <span class='fu'>baguette</span><span class='fu'>::</span><span class='fu'><a href='https://baguette.tidymodels.org/reference/bag_tree.html'>bag_tree</a></span><span class='op'>(</span>cost_complexity <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                     tree_depth <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                     min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"rpart"</span>, times <span class='op'>=</span> <span class='fl'>50L</span><span class='op'>)</span> |&gt;
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>

<span class='va'>rf_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/rand_forest.html'>rand_forest</a></span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, 
                       min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                       trees <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"ranger"</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>
  
<span class='va'>xgb_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/boost_tree.html'>boost_tree</a></span><span class='op'>(</span>tree_depth <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                      learn_rate <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                      loss_reduction <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                      min_n <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                      sample_size <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                      mtry <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                      trees <span class='op'>=</span> <span class='fl'>1000</span>,
                      stop_iter <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"xgboost"</span><span class='op'>)</span> |&gt; 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>
  
<span class='va'>svm_r_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/svm_rbf.html'>svm_rbf</a></span><span class='op'>(</span>cost <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                   rbf_sigma <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
                   margin <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
    <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"kernlab"</span><span class='op'>)</span> |&gt; 
    <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>
  
<span class='va'>nnet_spec</span> <span class='op'>&lt;-</span> 
  <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/mlp.html'>mlp</a></span><span class='op'>(</span>hidden_units <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>,
               penalty <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span>, 
               epochs <span class='op'>=</span> <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/tune.html'>tune</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
    <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"nnet"</span><span class='op'>)</span> |&gt; 
    <span class='fu'>parsnip</span><span class='fu'>::</span><span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_args.html'>set_mode</a></span><span class='op'>(</span><span class='st'>"regression"</span><span class='op'>)</span>
  
  
<span class='va'>specs_vol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"linear_reg"</span> <span class='op'>=</span> <span class='va'>lm_mod</span>, 
                  <span class='st'>"bag_mars"</span><span class='op'>=</span> <span class='va'>bag_mars_mod</span>,
                  <span class='st'>"decision_tree"</span> <span class='op'>=</span> <span class='va'>dec_tree</span>, 
                  <span class='st'>"bag_cart"</span> <span class='op'>=</span> <span class='va'>bag_cart_mod</span>, 
                  <span class='st'>"rf"</span> <span class='op'>=</span> <span class='va'>rf_spec</span>, 
                  <span class='st'>"xgb"</span> <span class='op'>=</span> <span class='va'>xgb_spec</span>,
                  <span class='st'>"svm_rbf"</span> <span class='op'>=</span> <span class='va'>svm_r_spec</span>, 
                  <span class='st'>"nnet_mlp"</span> <span class='op'>=</span> <span class='va'>nnet_spec</span>,
                  <span class='st'>"penalized_reg"</span> <span class='op'>=</span> <span class='va'>penalized_lm_mod</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Todas as especificações foram alocadas em uma lista que será usada mais à frente. Até aqui temos as duas recipes de pré-processamento a serem usadas nos dados e os 9 modelos especificados a serem tunados/ajustados.</p>
<p>Agora vem a pergunta: como juntar tudo isso?<br />
Em um workflow (ou um workflowset, melhor dizendo).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Definindo o workflowset (serão ajustados 18 modelos ao todo)</span>
<span class='va'>wflow_vol</span> <span class='op'>&lt;-</span> <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://workflowsets.tidymodels.org/reference/workflow_set.html'>workflow_set</a></span><span class='op'>(</span>
  models <span class='op'>=</span> <span class='va'>specs_vol</span>, <span class='co'>#lista de modelos</span>
  preproc <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    normalized <span class='op'>=</span> <span class='va'>normalized_vol_rec</span>,
    simple <span class='op'>=</span> <span class='va'>simple_vol_rec</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Criado o workflowset, então será definida a configuração e o tipo de tunagem a ser aplicada. Neste caso, o processo de tunagem usado (race tuning) avalia todos os modelos em um set inicial da reamostragem. Baseado na performance corrente das métricas, alguns parâmetros que produzem modelos ruins, do ponto de vista preditivo, são então descartados na sequência do processo. Mais sobre esse processo de tunagem pode ser encontrado no livro do <a href="https://www.tmwr.org/grid-search.html#racing">tidymodels</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Definindo as configurações da tunagem de parâmetros usando computação paralela</span>
<span class='va'>racing_ctrl</span> <span class='op'>&lt;-</span> <span class='fu'>finetune</span><span class='fu'>::</span><span class='fu'><a href='https://finetune.tidymodels.org/reference/control_race.html'>control_race</a></span><span class='op'>(</span>
  save_pred <span class='op'>=</span> <span class='cn'>TRUE</span>,
  parallel_over <span class='op'>=</span> <span class='st'>"everything"</span>,
  save_workflow <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>


<span class='co'># Definindo a execução em paralelo </span>
<span class='va'>clusters</span> <span class='op'>&lt;-</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>cl</span> <span class='op'>&lt;-</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>makePSOCKcluster</a></span><span class='op'>(</span><span class='va'>clusters</span><span class='op'>)</span>
<span class='fu'>doParallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/doParallel/man/registerDoParallel.html'>registerDoParallel</a></span><span class='op'>(</span><span class='va'>cl</span><span class='op'>)</span>

<span class='co'># Realizando a tunagem dos modelos</span>
<span class='va'>results_vol</span> <span class='op'>&lt;-</span>
  <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://workflowsets.tidymodels.org/reference/workflow_map.html'>workflow_map</a></span><span class='op'>(</span>
    <span class='va'>wflow_vol</span>,
    seed <span class='op'>=</span> <span class='fl'>1504</span>,
    resamples <span class='op'>=</span> <span class='va'>vol_folds</span>,
    control <span class='op'>=</span> <span class='va'>racing_ctrl</span>,
    fn <span class='op'>=</span> <span class='st'>"tune_race_anova"</span>,
    grid <span class='op'>=</span> <span class='fl'>25</span>,
    metrics <span class='op'>=</span> <span class='fu'>yardstick</span><span class='fu'>::</span><span class='fu'><a href='https://yardstick.tidymodels.org/reference/metric_set.html'>metric_set</a></span><span class='op'>(</span><span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/rmse.html'>rmse</a></span>,
                                    <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/rsq.html'>rsq</a></span>, 
                                    <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/huber_loss.html'>huber_loss</a></span>, 
                                    <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/mae.html'>mae</a></span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'># Parando a execução em paralelo </span>
<span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/makeCluster.html'>stopCluster</a></span><span class='op'>(</span><span class='va'>cl</span><span class='op'>)</span>
<span class='fu'>foreach</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/foreach/man/registerDoSEQ.html'>registerDoSEQ</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Após realização da tunagem e escolhida a melhor configuração de parâmetros dos modelos de melhor desempenho, é feita a avaliação usando gráficos de acordo com as métricas definidas:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Plotagem dos resultados para cada métrica utilizada</span>
<span class='va'>plot_results</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>race_rslts</span>, <span class='va'>mtrc</span> <span class='op'>=</span> <span class='st'>"rmse"</span>,<span class='va'>...</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/autoplot.html'>autoplot</a></span><span class='op'>(</span>
    <span class='va'>race_rslts</span>,
    rank_metric <span class='op'>=</span> <span class='va'>mtrc</span>,  
    metric <span class='op'>=</span> <span class='va'>mtrc</span>,       
    select_best <span class='op'>=</span> <span class='cn'>TRUE</span>,
    <span class='va'>...</span>
    <span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>plot_racing</span>
  
  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsave.html'>ggsave</a></span><span class='op'>(</span><span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span><span class='va'>mtrc</span>, <span class='st'>".png"</span><span class='op'>)</span>, 
                  path <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"plots"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>plot_racing</span><span class='op'>)</span>
  
<span class='op'>}</span>

<span class='fu'>plot_results</span><span class='op'>(</span><span class='va'>results_vol</span>, mtrc <span class='op'>=</span> <span class='st'>"rsq"</span><span class='op'>)</span>
<span class='fu'>plot_results</span><span class='op'>(</span><span class='va'>results_vol</span>, mtrc <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span>
<span class='fu'>plot_results</span><span class='op'>(</span><span class='va'>results_vol</span>, mtrc <span class='op'>=</span> <span class='st'>"huber_loss"</span><span class='op'>)</span>
<span class='fu'>plot_results</span><span class='op'>(</span><span class='va'>results_vol</span>, mtrc <span class='op'>=</span> <span class='st'>"mae"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="avaliação-da-qualidade-dos-modelos">Avaliação da qualidade dos modelos</h3>
<p>Em seguida, deve ser realizada a seleção do melhor modelo. Para isso, são criadas funções de:</p>
<ul>
<li>Seleção do melhor modelo.</li>
<li>Ajuste final do modelo selecionado.<br />
</li>
<li>Obtenção das métricas de avaliação do modelo selecionado no set de teste.</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Função para seleção de modelos de acordo com o R² (padrão)</span>
<span class='va'>select_models</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>grid_results</span>, <span class='va'>metric</span> <span class='op'>=</span> <span class='st'>"rsq"</span>, <span class='va'>rank_posit</span> <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>{</span>
  
  <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://workflowsets.tidymodels.org/reference/rank_results.html'>rank_results</a></span><span class='op'>(</span><span class='va'>grid_results</span>, 
                             select_best <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> |&gt; 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/relocate.html'>relocate</a></span><span class='op'>(</span><span class='va'>rank</span><span class='op'>)</span> |&gt; 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>.config</span>, <span class='va'>model</span>, <span class='va'>std_err</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
  <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>.metric</span> <span class='op'>==</span> <span class='st'>"rsq"</span> <span class='op'>&amp;</span> <span class='va'>rank</span> <span class='op'>==</span> <span class='va'>rank_posit</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>model_selected</span>
  <span class='fu'>EnvStats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/EnvStats/man/print.html'>print</a></span><span class='op'>(</span><span class='va'>model_selected</span><span class='op'>)</span>
  
<span class='op'>}</span>

<span class='co'># Função para ajuste final do modelo</span>
<span class='va'>fit_model</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>grid_results</span>, <span class='va'>model_ranked</span>, <span class='va'>df_split</span>, <span class='va'>metric</span> <span class='op'>=</span> <span class='st'>"rmse"</span><span class='op'>)</span><span class='op'>{</span>
    
    <span class='va'>name_model</span> <span class='op'>&lt;-</span> <span class='va'>model_ranked</span> |&gt; <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/pluck.html'>pluck</a></span><span class='op'>(</span><span class='st'>"wflow_id"</span>, <span class='fl'>1</span><span class='op'>)</span>
  
    <span class='va'>model</span> <span class='op'>&lt;-</span> <span class='va'>grid_results</span> |&gt; 
        <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://workflowsets.tidymodels.org/reference/extract_workflow_set_result.html'>extract_workflow_set_result</a></span><span class='op'>(</span>id <span class='op'>=</span> <span class='va'>name_model</span><span class='op'>)</span> |&gt;
        <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/show_best.html'>select_best</a></span><span class='op'>(</span>metric <span class='op'>=</span> <span class='va'>metric</span><span class='op'>)</span>
    
    <span class='va'>grid_results</span> |&gt; 
        <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/hardhat/man/hardhat-extract.html'>extract_workflow</a></span><span class='op'>(</span><span class='va'>name_model</span><span class='op'>)</span> |&gt;
        <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/finalize_model.html'>finalize_workflow</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span> |&gt; 
        <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/last_fit.html'>last_fit</a></span><span class='op'>(</span>split <span class='op'>=</span> <span class='va'>df_split</span>,
                       metrics <span class='op'>=</span> <span class='fu'>yardstick</span><span class='fu'>::</span><span class='fu'><a href='https://yardstick.tidymodels.org/reference/metric_set.html'>metric_set</a></span><span class='op'>(</span><span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/rmse.html'>rmse</a></span>, 
                                                       <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/rsq.html'>rsq</a></span>, 
                                                       <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/huber_loss.html'>huber_loss</a></span>, 
                                                       <span class='fu'>yardstick</span><span class='fu'>::</span><span class='va'><a href='https://yardstick.tidymodels.org/reference/mae.html'>mae</a></span><span class='op'>)</span><span class='op'>)</span>
    
<span class='op'>}</span>

<span class='co'># Função para obtenção da performance do melhor modelo no set de teste</span>
<span class='va'>metrics_mod</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>best_mod</span>, <span class='va'>model_ranked</span><span class='op'>)</span><span class='op'>{</span>
  
  <span class='va'>name_model</span> <span class='op'>&lt;-</span> <span class='va'>model_ranked</span> |&gt; <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/pluck.html'>pluck</a></span><span class='op'>(</span><span class='st'>"wflow_id"</span>, <span class='fl'>1</span><span class='op'>)</span>
  
  <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/collect_predictions.html'>collect_metrics</a></span><span class='op'>(</span><span class='va'>best_mod</span><span class='op'>)</span> |&gt; 
    <span class='fu'>kableExtra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span>caption <span class='op'>=</span> <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span><span class='st'>"Performance do modelo "</span>, 
                                         <span class='va'>name_model</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
    <span class='fu'>kableExtra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kable_classic.html'>kable_classic</a></span><span class='op'>(</span>full_width <span class='op'>=</span> <span class='cn'>F</span>, 
                              html_font <span class='op'>=</span> <span class='st'>"Cambria"</span>, 
                              font_size <span class='op'>=</span> <span class='fl'>16</span><span class='op'>)</span> |&gt; 
    <span class='fu'>kableExtra</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/save_kable.html'>save_kable</a></span><span class='op'>(</span>file <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"plots"</span>, 
                                             <span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span><span class='st'>"perf_"</span>, 
                                                        <span class='va'>name_model</span>, 
                                                        <span class='st'>".png"</span><span class='op'>)</span><span class='op'>)</span>,
                           self_contained <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
  
  <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/collect_predictions.html'>collect_metrics</a></span><span class='op'>(</span><span class='va'>best_mod</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Seleção, ajuste e avaliação do melhor modelo</span>
<span class='va'>best_model</span> <span class='op'>&lt;-</span> <span class='fu'>select_models</span><span class='op'>(</span>grid_results <span class='op'>=</span> <span class='va'>results_vol</span><span class='op'>)</span>

<span class='va'>fit_best_mod</span> <span class='op'>&lt;-</span> <span class='fu'>fit_model</span><span class='op'>(</span>grid_results <span class='op'>=</span> <span class='va'>results_vol</span>,
                        model_ranked <span class='op'>=</span> <span class='va'>best_model</span>,
                        df_split <span class='op'>=</span> <span class='va'>vol_split</span><span class='op'>)</span>

<span class='fu'>metrics_mod</span><span class='op'>(</span><span class='va'>fit_best_mod</span>, <span class='va'>best_model</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<figure>
<img src="rsq.png" alt="Figure 2 - Desempenho dos modelos." /><figcaption aria-hidden="true">Figure 2 - Desempenho dos modelos.</figcaption>
</figure>
<p>De modo a termos um ponto de comparação didático, serão comparados um modelo de qualidade intermediária e o melhor modelo. Esse processo se dá de forma similar ao realizado previamente, exceto que agora será selecionado o modelo ranqueado na posição número 10 (rank_posit = 1) em contraste ao melhor modelo (rank_posit = 1):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Seleção, ajuste e avaliação do modelo intermediário</span>
<span class='va'>intermediary_model</span> <span class='op'>&lt;-</span> <span class='fu'>select_models</span><span class='op'>(</span>grid_results <span class='op'>=</span> <span class='va'>results_vol</span>, rank_posit <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>

<span class='va'>fit_intermediary_model</span> <span class='op'>&lt;-</span> <span class='fu'>fit_model</span><span class='op'>(</span>grid_results <span class='op'>=</span> <span class='va'>results_vol</span>,
                                       model_ranked <span class='op'>=</span> <span class='va'>intermediary_model</span>,
                                       df_split <span class='op'>=</span> <span class='va'>vol_split</span><span class='op'>)</span>

<span class='fu'>metrics_mod</span><span class='op'>(</span><span class='va'>fit_intermediary_model</span>, <span class='va'>intermediary_model</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Agora ambos os modelos ajustados previamente serão comparados através de gráficos de dispersão contendo o volume predito vs volume observado, permitindo uma análise visual da qualidade preditiva de cada um. Para isso serão definidas duas funções para geração do gráfico de dispersão de cada modelo.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Função para plotar os resultados dos modelos</span>
<span class='va'>scatterplot</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>.x</span>, <span class='va'>.y</span><span class='op'>)</span><span class='op'>{</span>
    
    <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span> <span class='op'>+</span> 
        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>.pred</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>mapping <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>.pred</span>, y <span class='op'>=</span> <span class='va'>v</span><span class='op'>)</span>, 
                   alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
                   size <span class='op'>=</span> <span class='fl'>2</span>, 
                   color <span class='op'>=</span> <span class='st'>"black"</span>, 
                   fill <span class='op'>=</span> <span class='st'>"mediumspringgreen"</span>, 
                   pch <span class='op'>=</span> <span class='fl'>21</span><span class='op'>)</span> <span class='op'>+</span> 
        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>lty <span class='op'>=</span> <span class='fl'>2</span>, 
                    col <span class='op'>=</span> <span class='st'>"black"</span>, 
                    size <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'>tune</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/coord_obs_pred.html'>coord_obs_pred</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_classic</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>text <span class='op'>=</span> <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>"Source Code Pro"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ggtitle</a></span><span class='op'>(</span><span class='va'>.y</span><span class='op'>)</span> <span class='op'>+</span>
        <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='st'>"Volume Predito (m³)"</span>,
                      y <span class='op'>=</span> <span class='st'>"Volume Observado (m³)"</span><span class='op'>)</span> <span class='op'>-&gt;</span> <span class='va'>plot_scatterplot</span>
    
  <span class='fu'>ggplot2</span><span class='fu'>::</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggsave.html'>ggsave</a></span><span class='op'>(</span><span class='fu'>glue</span><span class='fu'>::</span><span class='fu'><a href='https://glue.tidyverse.org/reference/glue.html'>glue</a></span><span class='op'>(</span><span class='va'>.y</span>, <span class='st'>".png"</span><span class='op'>)</span>, path <span class='op'>=</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"plots"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>plot_scatterplot</span><span class='op'>)</span>
  
<span class='op'>}</span>

<span class='co'># Função para extrair os dados preditos e plotá-los vs os </span>
<span class='co'># dados observados usando a função anterior</span>
<span class='va'>accessing_models</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>mod1</span>, <span class='va'>mod2</span>, <span class='va'>model_ranked1</span>, <span class='va'>model_ranked2</span><span class='op'>)</span><span class='op'>{</span>
    
    <span class='va'>gsub_und</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>"_"</span>, <span class='st'>" "</span>, <span class='va'>x</span><span class='op'>)</span>
    <span class='va'>name_model1</span> <span class='op'>&lt;-</span> <span class='va'>model_ranked1</span> |&gt; <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/pluck.html'>pluck</a></span><span class='op'>(</span><span class='st'>"wflow_id"</span>, <span class='fl'>1</span><span class='op'>)</span> |&gt; <span class='fu'>gsub_und</span><span class='op'>(</span><span class='op'>)</span>
    <span class='va'>name_model2</span> <span class='op'>&lt;-</span> <span class='va'>model_ranked2</span> |&gt; <span class='fu'>purrr</span><span class='fu'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/pluck.html'>pluck</a></span><span class='op'>(</span><span class='st'>"wflow_id"</span>, <span class='fl'>1</span><span class='op'>)</span> |&gt; <span class='fu'>gsub_und</span><span class='op'>(</span><span class='op'>)</span>
    
    <span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/collect_predictions.html'>collect_predictions</a></span><span class='op'>(</span><span class='va'>mod1</span><span class='op'>)</span> |&gt; 
        <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>model <span class='op'>=</span> <span class='va'>name_model1</span><span class='op'>)</span> |&gt; 
        <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='fu'>workflowsets</span><span class='fu'>::</span><span class='fu'><a href='https://tune.tidymodels.org/reference/collect_predictions.html'>collect_predictions</a></span><span class='op'>(</span><span class='va'>mod2</span><span class='op'>)</span> |&gt; 
                      <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>model <span class='op'>=</span> <span class='va'>name_model2</span><span class='op'>)</span><span class='op'>)</span> |&gt;
        <span class='fu'>tidyr</span><span class='fu'>::</span><span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>nest</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span><span class='op'>)</span> |&gt; 
        <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>plots <span class='op'>=</span> <span class='fu'>map2</span><span class='op'>(</span><span class='va'>data</span>, <span class='va'>model</span>, <span class='va'>scatterplot</span><span class='op'>)</span><span class='op'>)</span>
    
<span class='op'>}</span>

<span class='fu'>accessing_models</span><span class='op'>(</span><span class='va'>fit_best_mod</span>, 
                 <span class='va'>fit_intermediary_model</span>, 
                 <span class='va'>best_model</span>, 
                 <span class='va'>intermediary_model</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<figure>
<img src="normalized_xgb.png" alt="Figure 3 - Volume observado vs volume predito usando o modelo XGBoost." /><figcaption aria-hidden="true">Figure 3 - Volume observado vs volume predito usando o modelo XGBoost.</figcaption>
</figure>
<h3 id="conclusão-da-modelagem">Conclusão da modelagem</h3>
<p>É possível observar que o modelo XGBoost com pré-processamento normalizado apresentou um desempenho elevado frente aos demais modelos, apontando a sua aplicabilidade para a predição de volume de madeira de eucalipto em florestas plantadas. É digno de nota que, de forma similar ao que foi apontado por Azevedo et al. (2020), o modelo de redes neurais artificiais (MLP) apresentou um R² de ~0,96.</p>
<h2 id="ª-etapa---reprodutibilidade">3ª etapa - Reprodutibilidade</h2>
<p>Agora vamos para etapa que foca no uso do pacote targets. Com o targets pode ser mantido uma rotina de trabalho reprodutível que evita ao máximo repetições. O pacote “aprende” como o seu fluxo de trabalho se encaixa e pula a execução de tarefas pesadas que já estão atualizadas. Desse modo, ele executa apenas as etapas necessárias ou que foram alteradas/adicionadas. Mais informações sobre esse pacote podem ser encontradas em seu <a href="https://books.ropensci.org/targets">manual</a>.</p>
<p><strong>E como o targets funciona?</strong></p>
<p>Basicamente ele depende de funções:<br />
Para todas as etapas da modelagem que foi realizada foi criada uma função que foi alocada em um script (functions.R), assim, o fluxo de trabalho é subdividido e pode rodar de forma mais independente. Lembra da pasta “Eucalipto_Volume/R” criada lá no começo? Então, dentro dessa pasta é onde está o script com as funções definidas. Esse script pode ser acessado <a href="https://github.com/TheilonMacedo/Eucalipto_Volume/blob/main/R/functions.R">aqui</a>. Um exemplo de função criada para a modelagem foi a da criação da base de dados na pasta “data”:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>readind_data</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span><span class='op'>{</span>
    
    <span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span><span class='op'>(</span><span class='st'>"data"</span><span class='op'>)</span>
    
    <span class='va'>link_train</span> <span class='op'>&lt;-</span> <span class='st'>"https://doi.org/10.1371/journal.pone.0238703.s007"</span>
    <span class='va'>link_test</span> <span class='op'>&lt;-</span> <span class='st'>"https://doi.org/10.1371/journal.pone.0238703.s008"</span>
    
    <span class='va'>dest_folder_train</span> <span class='op'>&lt;-</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"train.xlsx"</span><span class='op'>)</span>
    <span class='va'>dest_folder_test</span> <span class='op'>&lt;-</span> <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"data"</span>, <span class='st'>"test.xlsx"</span><span class='op'>)</span>
    
    <span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>link_train</span>, 
                         destfile <span class='op'>=</span> <span class='va'>dest_folder_train</span>, 
                         mode <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span> <span class='co'># wb se OS for Windows</span>
    <span class='fu'>utils</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/download.file.html'>download.file</a></span><span class='op'>(</span><span class='va'>link_test</span>, 
                         destfile <span class='op'>=</span> <span class='va'>dest_folder_test</span>, 
                         mode <span class='op'>=</span> <span class='st'>"wb"</span><span class='op'>)</span>
    
    <span class='va'>sheet_train</span> <span class='op'>&lt;-</span> <span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>dest_folder_train</span>, skip <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
    <span class='va'>sheet_test</span> <span class='op'>&lt;-</span> <span class='fu'>readxl</span><span class='fu'>::</span><span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span><span class='op'>(</span><span class='va'>dest_folder_test</span>, skip <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
    
    <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>sheet_train</span>, <span class='va'>sheet_test</span><span class='op'>)</span> |&gt; 
        <span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/janitor/man/clean_names.html'>clean_names</a></span><span class='op'>(</span><span class='op'>)</span> |&gt;  
        <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>stem</span><span class='op'>:</span><span class='va'>rotation</span><span class='op'>)</span>, 
                             <span class='fu'>forcats</span><span class='fu'>::</span><span class='va'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>)</span>,
                      <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>tx</span>, <span class='va'>d</span><span class='op'>)</span>, <span class='va'>as.integer</span><span class='op'>)</span><span class='op'>)</span>
    
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>As demais funções seguem esse mesmo estilo.</p>
<h3 id="usando-o-targets">Usando o targets</h3>
<p>É agora que o targets entra na brincadeira de vez. Para orquestrar o fluxo de trabalho primeiramente deve ser criado um script (_targets.R) alocado dentro da pasta principal (“Eucalipto_Volume”). Neste script são carregados os pacotes targets e tarchetypes (falo dele mais à frente), também é deve ser carregado o script com as funções definidas na etapa anterior e alocado na pasta “R”, a partir da função base::source() (perceba o uso do pacote here):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/targets/'>targets</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://docs.ropensci.org/tarchetypes/'>tarchetypes</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/source.html'>source</a></span><span class='op'>(</span><span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"R"</span>, <span class='st'>"functions.R"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Em seguida, deve ser criada uma lista tendo os targets como elementos usando a função targets::tar_targets() em que o seu primeiro argumento é o nome do target a ser criado e o segundo é a função do script “functions.R” a ser usada, no seguinte esquema:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>nome_do_target_1</span>, <span class='fu'>funcao_a_ser_executada</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>, <span class='co'># 1</span>
     <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>nome_do_target_2</span>, <span class='fu'>funcao_a_ser_executada</span><span class='op'>(</span><span class='va'>nome_do_target_1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># 2</span>
</code></pre>
</div>
</div>
<p>A função usada dentro do targets::tar_targets() geralmente requer como argumento o nome do target anterior, como no caso 2. Entretanto, targets que iniciam o fluxo de trabalho (caso 1) ou que não estão ligadas diretamente aos produtos intermediários da computação não requerem que seja passado algum argumento à sua função.</p>
<p>Neste trabalho, a lista completa de targets definidos de acordo com as funções pode ser observada a seguir:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>packages</span>, <span class='fu'>packages_used</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>dataset</span>, <span class='fu'>readind_data</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>vol_split</span>, <span class='fu'>split_data</span><span class='op'>(</span><span class='va'>dataset</span>, <span class='fl'>1504</span>, <span class='fl'>0.75</span>, <span class='va'>cod_volume</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>test_split</span>, <span class='fu'>test_set_split</span><span class='op'>(</span><span class='va'>vol_split</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>train_split</span>, <span class='fu'>train_set_split</span><span class='op'>(</span><span class='va'>vol_split</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>vol_resamples</span>, <span class='fu'>kfold_cv</span><span class='op'>(</span><span class='va'>train_split</span>, strata <span class='op'>=</span> <span class='va'>cod_volume</span>, repeats <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>normalized_vol_rec</span>, <span class='fu'>preproc_rec</span><span class='op'>(</span><span class='va'>train_split</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>simple_vol_rec</span>, <span class='fu'>simple_rec</span><span class='op'>(</span><span class='va'>train_split</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>all_specs</span>, <span class='fu'>def_specs</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>wflow_vol</span>, <span class='fu'>workflow_config</span><span class='op'>(</span><span class='va'>all_specs</span>, <span class='va'>normalized_vol_rec</span>, <span class='va'>simple_vol_rec</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>racing_ctrl</span>, <span class='fu'>racing_defs</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>results_vol</span>, <span class='fu'>race_tuning</span><span class='op'>(</span><span class='va'>wflow_vol</span>, <span class='va'>vol_resamples</span>, <span class='va'>racing_ctrl</span>, <span class='fl'>1504</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>plot_rsq</span>, <span class='fu'>plot_results</span><span class='op'>(</span><span class='va'>results_vol</span>, <span class='st'>"rsq"</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>best_model</span>, <span class='fu'>select_models</span><span class='op'>(</span><span class='va'>results_vol</span>, <span class='st'>"rmse"</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>intermediary_model</span>, <span class='fu'>select_models</span><span class='op'>(</span><span class='va'>results_vol</span>, <span class='st'>"rmse"</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>fit_best_mod</span>, <span class='fu'>fit_model</span><span class='op'>(</span><span class='va'>results_vol</span>, <span class='va'>best_model</span>, <span class='va'>vol_split</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>fit_intermediary_model</span>, <span class='fu'>fit_model</span><span class='op'>(</span><span class='va'>results_vol</span>, <span class='va'>intermediary_model</span>, <span class='va'>vol_split</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>metrics_best</span>, <span class='fu'>metrics_mod</span><span class='op'>(</span><span class='va'>fit_best_mod</span>, <span class='va'>best_model</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>metrics_intermediary</span>, <span class='fu'>metrics_mod</span><span class='op'>(</span><span class='va'>fit_intermediary_model</span>, <span class='va'>intermediary_model</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_target.html'>tar_target</a></span><span class='op'>(</span><span class='va'>model_comparison</span>, <span class='fu'>accessing_models</span><span class='op'>(</span><span class='va'>fit_best_mod</span>,
                                                           <span class='va'>fit_intermediary_model</span>, 
                                                           <span class='va'>best_model</span>, 
                                                           <span class='va'>intermediary_model</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>tarchetypes</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/tarchetypes/reference/tar_render.html'>tar_render</a></span><span class='op'>(</span><span class='va'>report</span>, <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>"report"</span>, <span class='st'>"report.Rmd"</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Essa lista possui alguns pontos dignos de destaque:</p>
<ol type="1">
<li>O targets possui algumas ferramentas de avaliação do fluxo de trabalho estabelecido, e uma das mais legais é a função <code>targets::tar_visnetwork</code>. Ela permite que o pipeline seja inspecionado a partir de um fluxograma que informa se os targets estão atualizados ou não.</li>
</ol>
<figure>
<img src="featured.jpg" alt="Figure 4 - Network para inspeção do pipeline criado. Círculo em cor cinza signfica que que o target está desatualizado ou passou por algum ajuste (deve ser computado via targets::tar_make()); círculo laranja indica que há algum erro no pipeline; círculo verde indica que o target está atualizado (up-to-date)." /><figcaption aria-hidden="true">Figure 4 - Network para inspeção do pipeline criado. Círculo em cor cinza signfica que que o target está desatualizado ou passou por algum ajuste (deve ser computado via <code>targets::tar_make()</code>); círculo laranja indica que há algum erro no pipeline; círculo verde indica que o target está atualizado (up-to-date).</figcaption>
</figure>
<ol start="2" type="1">
<li><p>Ao fim da lista, o target <code>tarchetypes::tar_render</code> permite que um relatório seja gerado a partir de um arquivo “.Rmd”. Assim, foi produzido um relatório simples, usando rmardown, visando ser uma amostra do que pode ser feito a partir desse orquestramento de trabalho. Esse exemplo pode ser expandido para a produção de um artigo acadêmico ou um relatório mais complexo. Dessa forma, pode-se realizar as análises do trabalho e gerar o material final em um único pipeline. No corpo do relatório produzido, foram adicionados chamados aos 3 penúltimos objetos da lista de targets (metrics_best, metrics_intermediary, model_comparison) usando a função <code>targets::tar_read()</code>, em que estes objetos targets são lidos dentro do relatório. Isso é necessário para que a função <code>tarchetypes::tar_render</code> saiba que o relatório só poderá ser produzido quando todas as análises do pipeline forém finalizadas e estes três últimos objetos gerados.</p></li>
<li><p>Outro ponto digno de nota é que esse processamento pode levar um tempo para ser computado. Com isso, rodá-lo novamente pode ser bem tedioso. Uma vantagem do targets é que ele memoriza os passos realizados e guarda os produtos obtidos. Dessa forma, caso seja realizada alguma alteração no pipeline, ele roda apenas as análises diretamente afetadas pela alteração feita. Por exemplo: caso seja adicionado um novo modelo na função <code>def_specs()</code>, que consta no arquivo <code>functions.R</code>, todas as análises diretamente afetadas por esse passo serão computadas novamente, porém os passos anteriores ao seu chamado não são recomputados, reduzindo o tempo e otimizando o trabalho.</p></li>
</ol>
<h3 id="reproduzindo-o-pipeline">Reproduzindo o pipeline</h3>
<p>Após realização da modelagem e orquestramento do trabalho, resta a sua publicação para que outras pessoas possam reproduzi-lo. Isso é feito de uma forma bem simples graças ao renv e ao targets. Basta clonar o repositório e salvá-lo em uma pasta principal, preferencialmente. Então, basta abrir o arquivo R Project (Eucalipto_Volume.Rproj) no RStudio e executar os seguintes comandos para instalar todos os pacotes necessários e rodar o pipeline, respectivamente:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>renv</span><span class='fu'>::</span><span class='fu'><a href='https://rstudio.github.io/renv/reference/restore.html'>restore</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># Pode demorar um pouco</span>
<span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_make.html'>tar_make</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># Roda o pipeline</span>
</code></pre>
</div>
</div>
<p>Caso você queira inspecionar o pipeline, para acompanhar o processo ou onde possa ter ocorrido possíveis falhas, basta chamar:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>targets</span><span class='fu'>::</span><span class='fu'><a href='https://docs.ropensci.org/targets/reference/tar_visnetwork.html'>tar_visnetwork</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># Apresenta o diagrama de execução</span>
</code></pre>
</div>
</div>
<h2 id="conclusão-ufa">Conclusão (UFA!)</h2>
<p>Essa foi uma introdução (espero que não muito cansativa) à uma das formas de utilização de modelos de machine learning com o tidymodels e de como aumentar a reprodutibilidade de trabalhos com os pacotes here, renv e targets. Confesso que esse projeto foi um trabalho bem bacana de realizar e utilizar estes pacotes se mostrou uma experiência super enriquecedora.<br />
Agradeço quem chegou até o final. Até mais!</p>
<h2 id="referências">Referências</h2>
<p>Azevedo, G. B. et al. Multi-volume modeling of Eucalyptus trees using regression and artificial neural networks. Plos one, v. 15, n. 9, p. e0238703, 2020.</p>
<p>Kuhn, M., Silge, J., 2021. Tidy Modeling with R. URL: <a href="https://www.tmwr.org/" class="uri">https://www.tmwr.org/</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
